<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Triangle Tactics Character Sheet</title>

    <!-- Normalize or reset CSS with your favorite library -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/7.0.0/normalize.min.css">

    <!-- Load paper.css for happy printing -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/paper-css/0.4.1/paper.css">
    
    <!-- Load custom styles -->
    <link rel="stylesheet" href="./styles.css">
    
    <!-- Set page size here: A5, A4 or A3 -->
    <!-- Set also "landscape" if you need -->
    <style>@page { size: A4 }</style>
</head>
<body class="A4">
    <section class="sheet padding-10mm" style="padding: 5mm;">
        <div class="text-center" style="margin-bottom: 10px;">
            <table class="center" style="width: 80%;">
                <tbody >
                <tr class="odd">
                <td style="text-align: center;"><input name="name" size="10em"></td>
                <td style="text-align: center;"><input name="ancestry" size="10em"></td>
                <!-- <td style="text-align: center;"><input name="exp_rem" size="10em"></td> -->
                <td style="text-align: center;"><input name="level" size="10em"></td>
                </tr>
                <tr class="even">
                <td style="text-align: center;"><span
                style="color: gray">Name</span></td>
                <td style="text-align: center;"><span
                style="color: gray">Ancestry</span></td>
                <!-- <td style="text-align: center;"><span style="color: gray">Unused
                exp</span></td> -->
                <td style="text-align: center;"><span style="color: gray">Level</span></td>
                </tr>
                </tbody>
            </table>
        </div>
        <div style="width: 60%; margin-left: auto; margin-right: auto; padding-bottom: 12px;">
            <div class="text-center">
                <table id="ability-scores">
                    <tr class="centered-input">
                        <td><input type="text" name="might" style="width: 30px;"></td>
                        <td><input type="text" name="agility" style="width: 30px;"></td>
                        <td><input type="text" name="intelligence" style="width: 30px;"></td>
                        <td><input type="text" name="charisma" style="width: 30px;"></td>
                    </tr>
                    <tr>
                        <td class="gray">Might</td>
                        <td class="gray">Agility</td>
                        <td class="gray">Intelligence</td>
                        <td class="gray">Charisma</td>
                    </tr>
                </table>
            </div>
            <div id="damage-thresholds-container" class="text-center">
                <table id="damage-thresholds">
                    <tr class="centered-input">
                        <td style="width: 3.6em;">
                            <div class="text-center">
                                <input type="text" style="width: 2em;" name="speed"/>
                            </div>
                        </td>
                        <td style="width: 2em;"><input type="text" name="hit" style="width: 2em;"></td>
                        <td style="width: 2em;"><input type="text" name="heavy" style="width: 2em;"></td>
                        <td style="width: 2em;"><input type="text" name="brutal" style="width: 2em;"></td>
                        <td style="width: 3.6em;">
                            <div style="display: flex; align-items: center;">
                                <div id="beyond-container" style="position: relative; width: 100%; z-index: 1; font-size: xx-large; margin: 0; padding: 0; padding-top: 8px; margin-top: -5px;">‚ü≥
                                    <div style="position: absolute; top: 0; width: 100%;">
                                        <p style="font-size: small; z-index: 1; width: 100%; background-color: transparent; border: 0; margin-top: 1.4em; margin-left: -0.2em;">+5</p>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td style="border-left: 0;">Speed</td>
                        <td>Hit</td>
                        <td>Heavy</td>
                        <td>Brutal</td>
                        <td style="border-right: 0;">Beyond</td>
                    </tr>
                </table>
                <span class="gray"><strong>Damage Thresholds</strong></span>
            </div>
            <div class="text-center item-header center" style="padding-block: 15px;">
                <table id="damage-table" class="center" style="width: fit-content">
                    <tr id="adrenaline-row" class="centered-input">
                        <td rowspan="3" style="width: 45px">
                            <div id="guard-container" style="position: relative; width: 100%; z-index: 1; font-size: xx-large; margin: 0; padding: 0; padding-top: 5px; margin-top: -5px;">&#9929;
                                <div style="position: absolute; top: 0; width: 100%; border: 1px;">
                                    <input type="text" style="font-size: medium; z-index: 1; width: 1em; background-color: transparent; border: 0;" name="guard">
                                    <!-- <p style=" margin-left: -0.3em; font-size: small;">+5</p> -->
                                </div>
                            </div>
                        </td>
                        <td class="triangles triangles-up">

                        </td>
                        <td rowspan="3" style="width: 45px"><input type="text" name="bonus" style="width: 25px;"></td>
                    </tr>
                    <tr>
                        <td style="padding: 0; line-height: 0.8;">
                            <span style="position: relative; top: -3px; font-size: smaller;">Focus / Fatigue</span>
                        </td>
                    </tr>
                    <tr id="exhaustion-row">
                        <!-- <td style="width: 60px">Fatigue</td> -->
                        <td class="triangles triangles-down"></td>
                        <!-- <td style="width: 60px">Bonus</td> -->
                    </tr>
                </table>
            </div>
        </div>



        <div class="distributer">
            <div class="minipage-smaller">
                <div class="text-center item-header" style="margin-top: -82px;">Armor</div>
                <table id="hit-mods" class="list-table wide-input input-offset">
                    <tr>
                        <td style="width: 45px;" class="text-center centered-input"><input type="text" name="hit_mod""></td>
                        <td style="width: 45px;" class="text-center centered-input"><input type="text" name="heavy_mod"></td>
                        <td style="width: 45px;" class="text-center centered-input"><input type="text" name="brutal_mod"></td>
                    </tr>
                    <tr>
                        <td style="width: 45px;" class="text-center centered-input"><input disabled value="Hit" type="text"></td>
                        <td style="width: 45px;" class="text-center centered-input"><input disabled value="Heavy" type="text"></td>
                        <td style="width: 45px;" class="text-center centered-input"><input disabled value="Brutal" type="text"></td>
                    </tr>
                <!-- </table>
                <table id="resistances" class="list-table wide-input"> -->
                    <tr>
                        <td colspan="2"><input disabled value="Armor Bulk" type="text" name="res3"></td>
                        <td><input type="text" name="res3_mod"></td>
                    </tr>
                    <tr>
                        <td colspan="2"><input value="Resistances?" type="text" name="res4"></td>
                        <td><input type="text" name="res4_mod"></td>
                    </tr>
                    <tr>
                        <td colspan="2"><input type="text" name="res5"></td>
                        <td><input type="text" name="res5_mod"></td>
                    </tr>
                    <tr>
                        <td colspan="2"><input type="text" name="res6"></td>
                        <td><input type="text" name="res6_mod"></td>
                    </tr>
                </table>
            </div>
            <div class="minipage minipage-large">
                
                <table id="weapons">
                    <tr>
                        <td style="width: 8.5em;">Weapon</td>
                        <td style="width: 4em;">Damage</td>
                        <!-- <td style="width: 3em;">Reach</td> -->
                        <td style="width: auto;">Tags</td>
                    </tr>
                    <tr>
                        <td><div><input type="text" name="wep1"></div></td>
                        <td><div><input type="text" name="wep1_dmg"></div></td>
                        <!-- <td><div><input type="text" name="wep1_reach"></div></td> -->
                        <td><div><input type="text" name="wep1_tags"></div></td>
                    </tr>
                    <tr>
                        <td><div><input type="text" name="wep2"></div></td>
                        <td><div><input type="text" name="wep2_dmg"></div></td>
                        <!-- <td><div><input type="text" name="wep2_reach"></div></td> -->
                        <td><div><input type="text" name="wep2_tags"></div></td>
                    </tr>
                    <tr>
                        <td><div><input type="text" name="wep3"></div></td>
                        <td><div><input type="text" name="wep3_dmg"></div></td>
                        <!-- <td><div><input type="text" name="wep3_reach"></div></td> -->
                        <td><div><input type="text" name="wep3_tags"></div></td>
                    </tr>
                </table>
            </div>

            <div class="minipage minipage-smaller" style="margin-top: -80px;">
                <div class="star-checkboxes center text-center" style="width: 100px;">
                    Hope here?
                    <label class="star-checkbox">
                        <input type="checkbox" name="star1">
                        <svg width="20" height="20" viewBox="0 0 20 20">
                            <polygon points="10,1 13,7 19,10 13,13 10,19 7,13 1,10 7,7"></polygon>
                        </svg>
                    </label>
                    <!-- <label class="star-checkbox">
                        <input type="checkbox" name="star2">
                        <svg width="20" height="20" viewBox="0 0 20 20">
                            <polygon points="10,1 13,7 19,10 13,13 10,19 7,13 1,10 7,7"></polygon>
                        </svg>
                    </label>
                    <label class="star-checkbox">
                        <input type="checkbox" name="star3">
                        <svg width="20" height="20" viewBox="0 0 20 20">
                            <polygon points="10,1 13,7 19,10 13,13 10,19 7,13 1,10 7,7"></polygon>
                        </svg>
                    </label>
                    <label class="star-checkbox">
                        <input type="checkbox" name="star4">
                        <svg width="20" height="20" viewBox="0 0 20 20">
                            <polygon points="10,1 13,7 19,10 13,13 10,19 7,13 1,10 7,7"></polygon>
                        </svg>
                    </label>
                    <label class="star-checkbox">
                        <input type="checkbox" name="star5">
                        <svg width="20" height="20" viewBox="0 0 20 20">
                            <polygon points="10,1 13,7 19,10 13,13 10,19 7,13 1,10 7,7"></polygon>
                        </svg>
                    </label>
                    <label class="star-checkbox">
                        <input type="checkbox" name="star5">
                        <svg width="20" height="20" viewBox="0 0 20 20">
                            <polygon points="10,1 13,7 19,10 13,13 10,19 7,13 1,10 7,7"></polygon>
                        </svg>
                    </label>
                    <label class="star-checkbox">
                        <input type="checkbox" name="star5">
                        <svg width="20" height="20" viewBox="0 0 20 20">
                            <polygon points="10,1 13,7 19,10 13,13 10,19 7,13 1,10 7,7"></polygon>
                        </svg>
                    </label>
                    <span class="text-center center" style="margin-inline: auto; padding-right: 20px;">Hope</span> -->
                </div>
                <!-- <div class="stances" style="width: fit-content;">
                    <table id="stance-table">
                        <tr>
                            <td>Attacking</td>
                        </tr>
                        <tr>
                            <td >
                                <hr>
                            </td>
                        </tr>
                        <tr>
                            <td>Controlling</td>
                        </tr>
                        <tr>
                            <td>
                                <hr>
                            </td>
                        </tr>
                        <tr>
                            <td>Defending</td>
                        </tr>
                    </table>
                </div> -->
            </div>
            
            <span style="width: 100%; display: inline-block;"></span>
        </div>

        <div style="clear: both;"></div>

        <div class="distributer">
            <div id="scars-minipage" class="minipage minipage-small">
                <div id="scars" class="text-center item-header" >Scars</div>
                <table id="scars-table" class="list-table wide-input">
                    <tr>
                        <td><input type="text" name="scar1"></td>
                        <td><input type="text" name="exp_mod1"></td>
                    </tr>
                    <tr>
                        <td><input type="text" name="scar2"></td>
                        <td><input type="text" name="exp_mod2"></td>
                    </tr>
                    <tr>
                        <td><input type="text" name="scar3"></td>
                        <td><input type="text" name="exp_mod3"></td>
                    </tr>
                    <tr>
                        <td><input type="text" name="scar4"></td>
                        <td><input type="text" name="exp_mod4"></td>
                    </tr>
                    <tr>
                        <td><input type="text" name="scar5"></td>
                        <td><input type="text" name="exp_mod5"></td>
                    </tr>
                    <tr>
                        <td><input type="text" name="scar6"></td>
                        <td><input type="text" name="exp_mod6"></td>
                    </tr>
                </table>
            </div>
            <div id="strain-minipage">
                <div class="text-center" style="width: 100%;">
                    <span style="margin-inline: auto;">Strain</span>
                </div>
                <div style="display: flex; align-items: center;">
                    <svg id="strain-svg" width="200" height="200" viewBox="0 0 200 200"></svg>
                    <!-- <div class="text-center center" style="position: relative; top: -50%; left: -50%; width: 0; display: flex; justify-content: center; align-items: center;">
                        <span class="text-center"">Pressure<br>Die</span>
                    </div> -->
                </div>
            </div>
            <div id="titles-minipage" class="minipage minipage-small">
                <div id="titles" class="text-center item-header" >Titles</div>
                <table id="title-table" class="list-table wide-input">
                    <tr>
                        <td><input type="text" name="exp1"></td>
                        <td><input type="text" name="exp_mod1"></td>
                    </tr>
                    <tr>
                        <td><input type="text" name="exp2"></td>
                        <td><input type="text" name="exp_mod2"></td>
                    </tr>
                    <tr>
                        <td><input type="text" name="exp3"></td>
                        <td><input type="text" name="exp_mod3"></td>
                    </tr>
                    <tr>
                        <td><input type="text" name="exp4"></td>
                        <td><input type="text" name="exp_mod4"></td>
                    </tr>
                    <tr>
                        <td><input type="text" name="exp5"></td>
                        <td><input type="text" name="exp_mod5"></td>
                    </tr>
                    <tr>
                        <td><input type="text" name="exp6"></td>
                        <td><input type="text" name="exp_mod6"></td>
                    </tr>
                </table>
            </div>
            <span style="width: 100%; display: inline-block;"></span>
        </div>

        <div class="distributer">
            <div class="minipage minipage-small currency center">
                <div id="coin-pouch" class="currency text-center item-header">Coin Pouch</div>
                    <table id="currency-table" class="list-table center" style="width: fit-content;">
                        <tr>
                            <td><input disabled value="Copper"></input></td>
                            <td><input type="text" name="cc"></td>
                        </tr>
                        <tr>
                            <td><input disabled value="Bronze"></input></td>
                            <td><input type="text" name="bc"></td>
                        </tr>
                        <tr>
                            <td><input disabled value="Silver"></input></td>
                            <td><input type="text" name="sc"></td>
                        </tr>
                        <tr>
                            <td><input disabled value="Gold"></input></td>
                            <td><input type="text" name="gc"></td>
                        </tr>
                        <tr>
                            <td><input disabled value="Platinum"></input></td>
                            <td><input type="text" name="pc"></td>
                        </tr>
                        <tr>
                            <td><input name="free_currency"></input></td>
                            <td><input type="text" name="fc"></td>
                        </tr>
                    </table>
            </div>
            <div class="minipage minipage-medium">
                <div class="text-center item-header" >Inventory<span style="font-size: 0.8em;" class="gray"> (5+Might)</span></div>
                <table id="inventory" class="wide-input">
                    <tr>
                        <td><input type="text" name="inv1"></td>
                        <td><input type="text" name="inv2"></td>
                    </tr>
                    <tr>
                        <td><input type="text" name="inv3"></td>
                        <td><input type="text" name="inv4"></td>
                    </tr>
                    <tr>
                        <td><input type="text" name="inv5"></td>
                        <td><input type="text" name="inv6"></td>
                    </tr>
                    <tr>
                        <td><input type="text" name="inv7"></td>
                        <td><input type="text" name="inv8"></td>
                    </tr>
                    <tr>
                        <td><input type="text" name="inv9"></td>
                        <td><input type="text" name="inv10"></td>
                    </tr>
                    <tr>
                        <td><input type="text" name="inv11"></td>
                        <td><input type="text" name="inv12"></td>
                    </tr>
                </table>
            </div>
            <div class="minipage minipage-small">
                <div class="text-center item-header" style="padding-bottom: 25px; ">Pocket</div>
                <!-- <hr style="width: 8em;"> -->
                <div class="center" style="width: fit-content;">
                    <textarea id="limitedTextarea" rows="5" cols="18" oninput="enforceMaxLines(this)"></textarea>
                </div>
            </div>
            <span style="width: 100%; display: inline-block;"></span>
        </div>

        <div style="clear: both;"></div>
        <div class="distributer">
            <div id="languages-minipage" class="minipage minipage-small" style="margin-left: 0px">
                <div id="languages" class="text-center item-header" >Languages</div>

                <table id="languages-table" class="list-table wide-input">
                    <tr>
                        <td><input type="text" name="lang1"></td>
                    </tr>
                    <tr>
                        <td><input type="text" name="lang2"></td>
                    </tr>
                    <tr>
                        <td><input type="text" name="lang3"></td>
                    </tr>
                    <tr>
                        <td><input type="text" name="lang4"></td>
                    </tr>
                    <tr>
                        <td><input type="text" name="lang5"></td>
                    </tr>
                    <tr>
                        <td><input type="text" name="lang6"></td>
                    </tr>
                </table>

            </div>
            <div class="minipage minipage-large">
                <div class="text-center item-header" >Abilities</div>
                <table id="abilities" class="list-table wide-input" >
                    <tr>
                        <td><input type="text" name="inv1"></td>
                        <td><input type="text" name="inv2"></td>
                        <td><input type="text" name="inv2"></td>
                    </tr>
                    <tr>
                        <td><input type="text" name="inv3"></td>
                        <td><input type="text" name="inv4"></td>
                        <td><input type="text" name="inv2"></td>
                    </tr>
                    <tr>
                        <td><input type="text" name="inv5"></td>
                        <td><input type="text" name="inv6"></td>
                        <td><input type="text" name="inv2"></td>
                    </tr>
                    <tr>
                        <td><input type="text" name="inv7"></td>
                        <td><input type="text" name="inv8"></td>
                        <td><input type="text" name="inv2"></td>
                    </tr>
                    <tr>
                        <td><input type="text" name="inv9"></td>
                        <td><input type="text" name="inv10"></td>
                        <td><input type="text" name="inv2"></td>
                    </tr>
                    <tr>
                        <td><input type="text" name="inv11"></td>
                        <td><input type="text" name="inv12"></td>
                        <td><input type="text" name="inv2"></td>
                    </tr>
                    <tr>
                        <td><input type="text" name="inv11"></td>
                        <td><input type="text" name="inv12"></td>
                        <td><input type="text" name="inv2"></td>
                    </tr>
                    <tr>
                        <td>Attacking</td>
                        <td>Controlling</td>
                        <td>Defending</td>
                    </tr>
                    <tr style="height: 10px;">
                        <td></td>
                        <td style=" border-inline: 1px solid #232323;"></td>
                        <td></td>
                    </tr>
                </table>


            </div>
            <div id="deeds-minipage" class="minipage minipage-small" style="margin-right: 0px;">
                
                <div id="deeds" class="text-center item-header" >Deeds</div>
                <table id="deeds-table" class="list-table wide-input">
                    <tr>
                        <td><input type="text" name="deed1"></td>
                    </tr>
                    <tr>
                        <td><input type="text" name="deed2"></td>
                    </tr>
                    <tr>
                        <td><input type="text" name="deed3"></td>
                    </tr>
                    <tr>
                        <td><input type="text" name="deed4"></td>
                    </tr>
                    <tr>
                        <td><input type="text" name="deed5"></td>
                    </tr>
                    <tr>
                        <td><input type="text" name="deed6"></td>
                    </tr>
                </table>
            </div>
            <span style="width: 100%; display: inline-block;"></span>
        </div>
    </section>
    <script>
        localStorage = window['localStorage']
        loadState()
        document.addEventListener('change', function(event) {
            saveChange(event.target);
        }, true);

        function tabOnEnter(event) {
            if(event.keyCode === 13) { event.preventDefault(); this.dispatchEvent(new Event('keydown', { keyCode: 9 })); }
        }

        function enforceMaxLines(textarea) {
            const maxRows = textarea.rows+1;
            const lineHeight = parseInt(window.getComputedStyle(textarea).lineHeight);
            const maxHeight = lineHeight * maxRows;

            if (textarea.scrollHeight > maxHeight) {
                textarea.value = textarea.value.slice(0, textarea.value.length - 1);
            }
        }
        function saveChange(htmlObj) {
            localStorage[htmlObj.name] = htmlObj.value;
        }
        function loadState() {
            for (const [key, val] of Object.entries(localStorage)) {
                document.getElementsByName(key).value = val
            }
        }
    </script>
    <script>
        const centerX = 100, centerY = 100;
        const arms = 12;
        const startRadius = 10, endRadius = 80; // Adjusted start radius to be smaller
        const rotationDegrees = 126; // 35% of a circle (360 * 0.35)
        const steps = 100; // number of segments per arm
        const nodeRadius = 6; // radius of node at end of each arm (8 gives smooth arms)
        const armWidth = 8; // width of the arms
        const nodeWrapPercent = 0.7; // 70% wrap around nodes

        function polarPoint(r, angleDeg) {
            const rad = (Math.PI / 180) * angleDeg;
            return {
                x: centerX + r * Math.cos(rad),
                y: centerY + r * Math.sin(rad)
            };
        }

        function getPointAlongArc(centerX, centerY, radius, angleStart, angleEnd, percent) {
            const angle = angleStart + (angleEnd - angleStart) * percent;
            const rad = (Math.PI / 180) * angle;
            return {
                x: centerX + radius * Math.cos(rad),
                y: centerY + radius * Math.sin(rad)
            };
        }

        let svgContent = "";

        // Generate arms
        for (let i = 0; i < arms; i++) {
            const baseAngle = (360 / arms) * i;
            let pathPoints = [];
            let innerPathPoints = [];
            
            // Calculate node position at 80% of arm length
            const nodePosition = 0.8;
            const nodeR = startRadius + (endRadius - startRadius) * nodePosition;
            const nodeAngle = baseAngle + rotationDegrees * nodePosition;
            const nodeCenter = polarPoint(nodeR + nodeRadius, nodeAngle);
            
            // Build the outer curve of the arm
            for (let j = 0; j <= steps; j++) {
                const t = j / steps;
                
                if (t <= 0.8) {
                    // Regular spiral segment before the node
                    const r = startRadius + (endRadius - startRadius) * t;
                    const angle = baseAngle + rotationDegrees * t;
                    pathPoints.push(polarPoint(r, angle));
                } 
                // else {
                //     // Wrap around the node with a smooth continuation from the spiral
                //     const previousPoint = pathPoints[pathPoints.length - 1]; // Get last point of spiral
                //     const normalizedPercent = (t - nodePosition) / (1 - nodePosition);
                    
                //     // Calculate the angle to ensure smooth continuation
                //     const tangentAngle = baseAngle + rotationDegrees;
                //     const wrapAngle = nodeAngle + normalizedPercent * 360 * nodeWrapPercent;
                    
                //     // Use a blend between tangent direction and circular path for smooth transition
                //     const blendFactor = Math.min(1, normalizedPercent * 3); // Faster blend for smoother transition
                    
                //     // Calculate the radius with a smooth transition
                //     const distanceToNode = Math.sqrt(
                //         Math.pow(nodeCenter.x - previousPoint.x, 2) + 
                //         Math.pow(nodeCenter.y - previousPoint.y, 2)
                //     );
                    
                //     // Blend the radius from the spiral end to the node circle
                //     const curveRadius = nodeRadius + armWidth/2 - (armWidth/2) * blendFactor;
                    
                //     pathPoints.push({
                //         x: nodeCenter.x + curveRadius * Math.cos((Math.PI / 180) * wrapAngle),
                //         y: nodeCenter.y + curveRadius * Math.sin((Math.PI / 180) * wrapAngle)
                //     });
                // }
            }
            
            // Build the inner curve to create the lens shape
            for (let j = steps; j >= 0; j--) {
                const t = j / steps;
                
                if (t <= 0.84) {
                    // Regular spiral segment inner curve
                    const r = Math.max(1, startRadius + (endRadius - startRadius) * t - armWidth);
                    const angle = baseAngle + rotationDegrees * t;
                    innerPathPoints.push(polarPoint(r, angle));
                } else {
                    // Inner curve wrapping around the node
                    const wrapStart = nodeAngle + 320 * nodeWrapPercent;;
                    const wrapEnd = nodeAngle 
                    const wrapPercent = (t - nodePosition) / (1 - nodePosition);
                    const wrapAngle = wrapStart + wrapPercent * (wrapEnd - wrapStart);
                    innerPathPoints.push({
                        x: nodeCenter.x + (nodeRadius * (2 - (t - 0.828) / 0.15)) * Math.cos((Math.PI / 180) * wrapAngle),
                        y: nodeCenter.y + (nodeRadius * (2 - (t - 0.828) / 0.15)) * Math.sin((Math.PI / 180) * wrapAngle)
                    });
                }
            }
            
            // Combine outer and inner paths to create a closed shape
            let pathD = `M ${pathPoints[0].x.toFixed(2)},${pathPoints[0].y.toFixed(2)} `;
            
            // Add outer path
            for (let j = 1; j < pathPoints.length; j++) {
                pathD += `L ${pathPoints[j].x.toFixed(2)},${pathPoints[j].y.toFixed(2)} `;
            }
            
            // Add inner path in reverse
            for (let j = 0; j < innerPathPoints.length; j++) {
                pathD += `L ${innerPathPoints[j].x.toFixed(2)},${innerPathPoints[j].y.toFixed(2)} `;
            }
            
            // Close the path
            pathD += "Z";
            
            // Add the arm to SVG
            svgContent += `<path class="spiral-arm" name="arm${i+1}" d="${pathD}" stroke="#282828" stroke-width="1" fill="white" />\n`;
            
            // Draw the node circle
            svgContent += `<circle cx="${nodeCenter.x.toFixed(2)}" cy="${nodeCenter.y.toFixed(2)}" r="${nodeRadius}" stroke="#282828" stroke-width="1" fill="white" opacity="1" />\n`;
        }

        document.querySelector('#strain-svg').innerHTML = svgContent;

        // Make arms clickable to toggle active state
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.spiral-arm').forEach(arm => {
                arm.addEventListener('click', () => {
                    arm.classList.toggle('active');
                    if (arm.classList.contains('active')) {
                        arm.setAttribute('fill', '#000');
                    } else {
                        arm.setAttribute('fill', 'white');
                    }
                });
            });
        });
    </script>
    <script>
    document.querySelectorAll('.ring-part').forEach(part => {
        part.addEventListener('click', () => {
        part.classList.toggle('active');
        });
    });
    </script>
      <script>
        document.querySelectorAll('.triangle-checkbox').forEach(checkbox => {
          checkbox.addEventListener('click', function() {
            const input = this.querySelector('input[type="checkbox"]');
            input.checked = !input.checked;
          });
        });
      </script>
    <script>
        document.querySelectorAll('#adrenaline-row .triangles-up').forEach(row => {
            for (let i = 0; i < 9; i++) {
                row.innerHTML += `<label class="triangle-checkbox">
                                <input type="checkbox" name="foc${i+1}">
                                <svg style="width: 14px; height: fit-content" viewBox="0 0 10 10">
                                <polygon points="5,3 9,9 1,9"></polygon>
                                </svg>
                            </label>`;
            }
        });

        document.querySelectorAll('#exhaustion-row .triangles-down').forEach(row => {
            for (let i = 0; i < 9; i++) {
                row.innerHTML += `<label class="triangle-checkbox">
                                <input type="checkbox" name="fat${i+1}">
                                <svg style="width: 14px; height: 14px" viewBox="0 0 10 10">
                                <polygon points="5,7 9,1 1,1"></polygon>
                                </svg>
                            </label>`;
            }
        });
    </script>
    <script>
        document.querySelectorAll('.star-checkbox').forEach(star => {
            star.addEventListener('click', function() {
                const input = this.querySelector('input[type="checkbox"]');
                input.checked = !input.checked;
            });
        });
    </script>
</body>
</html>